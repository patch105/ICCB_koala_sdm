---
title: "ICCB Species data download"
author: "Scott Forrest and Charlotte Patterson"
date: "`r Sys.Date()`"
execute: 
  cache: false
# bibliography: references.bib
toc: true
number-sections: false
format: 
  html:
    self-contained: true
    code-fold: show
    code-tools: true
    df-print: paged
    code-line-numbers: true
    code-overflow: scroll
    fig-format: png
    fig-dpi: 300
  pdf:
    geometry: 
      - top=30mm
      - left=30mm
editor:
  source
abstract: |
  In this script we are downloading data from ALA (with an option for GBIF) for koalas (Phascolarctos cinereus) in the South-East Queensland (SEQ) region. We are then cleaning the data and in other scripts creating a species distribution model for current and future climate scenarios.
---

## Install packages

```{r}

# install.packages("galah")

```

## Import packages

```{r}

library(tidyverse)
library(galah)
library(sf)

```

## To cite the `galah` package

```{r}

# Package citation
citation(package = "galah")

```

## Import spatial extent

```{r}

# Load the study area shapefile
SEQ_extent <- st_read("Data/Environmental_variables/Local_Government_Areas.shp")

# Create a map using ggplot2
map <- ggplot(data = SEQ_extent) +
  geom_sf(fill = "orange", color = "black") +    # Plot polygons with border
  ggtitle("South-East Queensland Spatial Extent") +             # Add title
  theme_minimal()                                # Use a clean theme

# Display the map
print(map)

```

```{r}

SEQ_extent <- SEQ_extent %>% dplyr::filter(
  abbrev_nam %in% c("BRISBANE", 
                    "GOLD COAST", 
                    "IPSWICH", 
                    "LOCKYER VALLEY", 
                    "LOGAN", 
                    "MORETON BAY", 
                    "NOOSA", 
                    "REDLAND", 
                    "SCENIC RIM", 
                    "SOMERSET", 
                    "SUNSHINE COAST", 
                    "TOOWOOMBA")
) 

# Create a map using ggplot2
map <- ggplot(data = SEQ_extent) +
  geom_sf(fill = "orange", color = "black") +    # Plot polygons with border
  ggtitle("South-East Queensland Spatial Extent") +             # Add title
  theme_minimal()                                # Use a clean theme

# Display the map
print(map)

```

## Atlas of Living Australia using "galah" package

To access records from the ALA, you will need to be registered.

There are two registration options:

1.  If you are affiliated with an Australian institution, you might be able to register for ALA through your institution. Find your institution in the list of institutions when you select 'Login' [on the ALA website](https://www.ala.org.au/). Follow the prompts to enter your institution email and password. If your institution is not listed, you will need to register for an ALA account.

2. If you are not affiliated with an Australian institution, you will need to register for an ALA account. You can do this by selecting 'Register' [on the ALA website](https://www.ala.org.au/). Follow the prompts to enter your email and password.

```{r}

galah_config(atlas = "ALA",
             username = "scott.forrest@hdr.qut.edu.au",
             email = "scott.forrest@hdr.qut.edu.au"
             # password = "Password"
             )

```

## Download koala data from ALA

```{r}

koala_occurrences <- galah_call() |>
  galah_identify("Phascolarctos cinereus") |>
  galah_filter(
    stateProvince == "Queensland",
    occurrenceStatus == "PRESENT"
  ) |>
  # galah_select(institutionID, group = "basic") |>
  atlas_occurrences()

```


```{r}

# Create a map using ggplot2
map <- ggplot(data = bris) +
  geom_sf(fill = "orange", color = "black") +    # Plot polygons with border
  geom_point(data = koala_occurrences,
             aes(x = decimalLongitude,
                 y = decimalLatitude),
             color = "blue", size = 0.5) + # Add points for occurrences
  ggtitle("South-East Queensland Spatial Extent") +             # Add title
  theme_minimal()                                # Use a clean theme

# Display the map
print(map)

```

